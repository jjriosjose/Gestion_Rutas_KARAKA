
<!-- Este bloque representa la sección corregida del código JavaScript para aplicar filtros correctamente -->
<script>
function aplicarFiltros() {
    const vendedor = document.getElementById("filtroVendedor").value;
    const gestor = document.getElementById("filtroGestor").value;
    const semana = document.getElementById("filtroSemana").value;
    const dia = document.getElementById("filtroDia").value;
    const condicion = document.getElementById("filtroCondicion").value;
    const buscar = document.getElementById("filtroBuscar").value.toLowerCase();
    const clienteSelect = document.getElementById("filtroCliente");

    const filtrado = dataOriginal.filter(d =>
        (!vendedor || d.vendedor === vendedor) &&
        (!gestor || d.gestor === gestor) &&
        (!semana || d.semana === semana) &&
        (!dia || d.dia === dia) &&
        (!condicion || d.condicion === condicion) &&
        (!buscar || (d.RazonSocial && d.RazonSocial.toLowerCase().includes(buscar)))
    );

    // Limpiar y llenar el filtro de clientes con los filtrados
    clienteSelect.innerHTML = '<option value="">-- Todos --</option>';
    filtrado.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c.RazonSocial;
        opt.textContent = c.RazonSocial;
        clienteSelect.appendChild(opt);
    });

    mostrarClientes(filtrado);

    const cliente = clienteSelect.value;
    if (cliente) {
        const encontrado = filtrado.find(d => d.RazonSocial === cliente);
        if (encontrado) {
            const lat = parseFloat(encontrado.latitud);
            const lng = parseFloat(encontrado.longitud);
            map.setView([lat, lng], 15);
            capaClientes.eachLayer(m => {
                if (m.getLatLng().lat === lat && m.getLatLng().lng === lng) {
                    m.openPopup();
                }
            });
        }
    }
}
</script>
