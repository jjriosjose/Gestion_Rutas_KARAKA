
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mapa Interactivo - Rutas de Vendedores</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        #panel {
            position: absolute;
            top: 70px;
            left: 10px;
            width: 280px;
            max-height: 85%;
            background: white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
            padding: 10px;
            overflow-y: auto;
            z-index: 1000;
            border-radius: 8px;
        }
        #panel-toggle {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #007bff;
            color: white;
            padding: 8px 12px;
            border-radius: 30px;
            font-weight: bold;
            z-index: 1001;
            cursor: pointer;
        }
        .btn-float {
            position: absolute;
            right: 10px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 12px;
            bottom: 40px;
            z-index: 1001;
        }
        .btn-float button {
            border: none;
            padding: 8px 12px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            font-size: 14px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .btn-visita { background: #ff0066; }
        .btn-nuevo { background: #008800; }
        .btn-registro { background: #007bff; }
        .btn-float img {
            width: 20px;
            height: 20px;
            margin-right: 6px;
        }
        select, input {
            width: 100%;
            margin-bottom: 10px;
            padding: 6px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        button[type="button"] {
            width: 100%;
            background-color: #007bff;
            color: white;
            padding: 8px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="panel-toggle">☰ Filtros</div>
    <div id="panel">
        <label>Vendedor</label>
        <select id="filtroVendedor"></select>
        <label>Gestor</label>
        <select id="filtroGestor"></select>
        <label>Semana</label>
        <select id="filtroSemana"></select>
        <label>Día</label>
        <select id="filtroDia"></select>
        <label>Condición</label>
        <select id="filtroCondicion"></select>
        <label>Buscar Cliente</label>
        <input id="filtroBuscar" placeholder="Nombre del cliente" />
        <label>Cliente</label>
        <select id="filtroCliente"></select>
        <button type="button" onclick="restaurarMapa()">Restaurar</button>
    </div>
    <div id="map"></div>
    <div class="btn-float">
        <button class="btn-registro"><img src="https://cdn-icons-png.flaticon.com/512/684/684908.png" /> Registrar Visita</button>
        <button class="btn-nuevo"><img src="https://cdn-icons-png.flaticon.com/512/992/992651.png" /> Nuevo Cliente</button>
        <button class="btn-visita"><img src="https://cdn-icons-png.flaticon.com/512/2550/2550203.png" /> Visitar Cliente</button>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        const map = L.map('map').setView([18.5, -69.5], 8);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        const markers = [];
        const urlCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTnmjSg8mtidztak7cO6Es8tOTRujAes62qA9gsu1FYn219IaLqBpkYlIgZJgDNcpKHATaG9tWqwrE7/pub?output=csv";

        Papa.parse(urlCSV, {
            download: true,
            header: true,
            complete: function(results) {
                const data = results.data;
                data.forEach(row => {
                    if (row.latitud && row.longitud) {
                        const marker = L.marker([parseFloat(row.latitud.replace(',', '.')), parseFloat(row.longitud.replace(',', '.'))])
                            .addTo(map)
                            .bindPopup(`<b>${row.RazonSocial}</b><br>Gestor: ${row.gestor_servicio}`);
                        markers.push(marker);
                    }
                });
            }
        });

        function restaurarMapa() {
            map.setView([18.5, -69.5], 8);
        }

        document.getElementById('panel-toggle').onclick = () => {
            const panel = document.getElementById('panel');
            panel.style.display = (panel.style.display === 'none') ? 'block' : 'none';
        };
    </script>
</body>
</html>
